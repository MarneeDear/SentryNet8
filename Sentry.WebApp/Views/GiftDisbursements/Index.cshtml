@model Sentry.WebApp.ViewModels.GiftDisbursements.GiftDisbursementDashboard

<ul class="page-title">
    <li>
        <h1>
            Welcome to Your @Model.Title Dashboard
        </h1>
    </li>
</ul>

<div id="content-container" class="content-container" role="main">
    <div class="col-md-12">
        @await Html.PartialAsync("_AlternateApproversSwitch")
    </div>
    <div class="col-md-12 py-3">
        <div class="col-md-4 form-group mt-2">
                <label class="control-label" for="DisbursementSearchInput">Search</label>
            <br />
                <div class="d-inline-flex">
                    <input id="DisbursementSearchInput" type="text" class="form-control" placeholder="Search by Form Number" />
                    <button type="button" class="btn btn-primary ml-3" id="DisbursementSearchButton" title="Search Disbursements"><i role="img" class="fas fa-search"></i></button>
                </div>
            <p id="DisbursementSearchMessage" class="text-danger"></p>
        </div>
    </div>
    <div class="col-md-12 mt-2">
        <h3 class="text-center">Total Counts</h3>
        <table id="CountsTable" class="table table-striped">
            <thead>
                <tr>
                    <th>
                        Associate VP
                    </th>
                    <th>
                        Vice President
                    </th>
                    <th>
                        CFO
                    </th>
                    <th>
                        General Counsel
                    </th>
                    <th>
                        AP Reviewer
                    </th>
                    <th>
                        Scholarship
                    </th>
                    <th>
                        AP Manager
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <a href="#AVP">@Model.AssociateVicePresidentDisbursements.GiftDisbursements.Count()</a>                        
                    </td>
                    <td>
                        <a href="#VP">@Model.VicePresidentDisbursements.GiftDisbursements.Count()</a>
                    </td>
                    <td>
                        <a href="#CFO">@Model.CFODisbursements.GiftDisbursements.Count()</a>
                    </td>
                    <td>
                        <a href="#GC">@Model.GeneralCounselDisbursements.GiftDisbursements.Count()</a>
                    </td>
                    <td>
                        <a href="#APReview">@Model.ApReviewerDisbursements.GiftDisbursements.Count()</a>
                    </td>
                    <td>
                        <a href="#Scholarship">@Model.ScholarshipDisbursements.GiftDisbursements.Count()</a>
                    </td>
                    <td>
                        <a href="#APManager">@Model.ApManagerDisbursements.GiftDisbursements.Count()</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="col-md-12 mt-2" id="AVP">
        <h3 class="text-center" >Associate Vice President</h3>
        <table class="table table-hover table-striped ApproverDisbursementTable">
            <thead>
                <tr>
                    <th style="display: none">giftDisbursementId</th>
                    <th>
                        Preparer
                    </th>
                    <th>
                        Form #
                    </th>
                    <th>
                        Payment Type
                    </th>
                    <th>
                        Department
                    </th>
                    <th>
                        Amount
                    </th>
                    <th>
                        Date Approved
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var disbursement in Model.AssociateVicePresidentDisbursements.GiftDisbursements)
                {
                    <tr>
                        <td style="display: none">@disbursement.Id</td>
                        <td>@disbursement.PreparedByFirstName @disbursement.PreparedByLastName</td>
                        <td>
                            @disbursement.FormNumber
                        </td>
                        <td>
                            @disbursement.PayeePaymentType
                        </td>
                        <td>
                            @disbursement.DepartmentName
                        </td>
                        <td>
                            @disbursement.Total
                        </td>
                        <td>
                            @disbursement.LastApprovedOnDate
                        </td>
                    </tr>
                }
            </tbody>
        </table>

    </div>
    <div class="col-md-12 mt-2" id="VP">
        <h3 class="text-center">Vice President</h3>
        <table class="table table-hover table-striped ApproverDisbursementTable">
            <thead>
                <tr>
                    <th style="display: none">giftDisbursementId</th>
                    <th>
                        Preparer
                    </th>
                    <th>
                        Form #
                    </th>
                    <th>
                        Payment Type
                    </th>
                    <th>
                        Department
                    </th>
                    <th>
                        Amount
                    </th>
                    <th>
                        Date Approved
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var disbursement in Model.VicePresidentDisbursements.GiftDisbursements)
                {
                    <tr>
                        <td style="display: none">@disbursement.Id</td>
                        <td>@disbursement.PreparedByFirstName @disbursement.PreparedByLastName</td>
                        <td>
                            @disbursement.FormNumber
                        </td>
                        <td>
                            @disbursement.PayeePaymentType
                        </td>
                        <td>
                            @disbursement.DepartmentName
                        </td>
                        <td>
                            @disbursement.Total
                        </td>
                        <td>
                            @disbursement.LastApprovedOnDate
                        </td>
                    </tr>
                }
            </tbody>
        </table>

    </div>
    <div class="col-md-12 mt-2">
        <h3 class="text-center" id="CFO">CFO</h3>
        <table class="table table-hover table-striped ApproverDisbursementTable">
            <thead>
                <tr>
                    <th style="display: none">giftDisbursementId</th>
                    <th>
                        Preparer
                    </th>
                    <th>
                        Form #
                    </th>
                    <th>
                        Payment Type
                    </th>
                    <th>
                        Department
                    </th>
                    <th>
                        Amount
                    </th>
                    <th>
                        Date Approved
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var disbursement in Model.CFODisbursements.GiftDisbursements)
                {
                    <tr>
                        <td style="display: none">@disbursement.Id</td>
                        <td>@disbursement.PreparedByFirstName @disbursement.PreparedByLastName</td>
                        <td>
                            @disbursement.FormNumber
                        </td>
                        <td>
                            @disbursement.PayeePaymentType
                        </td>
                        <td>
                            @disbursement.DepartmentName
                        </td>
                        <td>
                            @disbursement.Total
                        </td>
                        <td>
                            @disbursement.LastApprovedOnDate
                        </td>
                    </tr>
                }
            </tbody>
        </table>

    </div>
    <div class="col-md-12 mt-2">
        <h3 class="text-center" id="GC">General Counsel</h3>
        <table class="table table-hover table-striped ApproverDisbursementTable">
            <thead>
                <tr>
                    <th style="display: none">giftDisbursementId</th>
                    <th>
                        Preparer
                    </th>
                    <th>
                        Form #
                    </th>
                    <th>
                        Payment Type
                    </th>
                    <th>
                        Department
                    </th>
                    <th>
                        Amount
                    </th>
                    <th>
                        Date Approved
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var disbursement in Model.GeneralCounselDisbursements.GiftDisbursements)
                {
                    <tr>
                        <td style="display: none">@disbursement.Id</td>
                        <td>@disbursement.PreparedByFirstName @disbursement.PreparedByLastName</td>
                        <td>
                            @disbursement.FormNumber
                        </td>
                        <td>
                            @disbursement.PayeePaymentType
                        </td>
                        <td>
                            @disbursement.DepartmentName
                        </td>
                        <td>
                            @disbursement.Total
                        </td>
                        <td>
                            @disbursement.LastApprovedOnDate
                        </td>
                    </tr>
                }
            </tbody>
        </table>

    </div>
    <div class="col-md-12 mt-2" id="APReview">
        <h3 class="text-center">AP Reviewer</h3>
        <table class="table table-hover table-striped ApproverDisbursementTable">
            <thead>
                <tr>
                    <th style="display: none">giftDisbursementId</th>
                    <th>
                        Preparer
                    </th>
                    <th>
                        Form #
                    </th>
                    <th>
                        Payment Type
                    </th>
                    <th>
                        Department
                    </th>
                    <th>
                        Amount
                    </th>
                    <th>
                        Date Approved
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var disbursement in Model.ApReviewerDisbursements.GiftDisbursements)
                {
                    <tr>
                        <td style="display: none">@disbursement.Id</td>
                        <td>@disbursement.PreparedByFirstName @disbursement.PreparedByLastName</td>
                        <td>
                            @disbursement.FormNumber
                        </td>
                        <td>
                            @disbursement.PayeePaymentType
                        </td>
                        <td>
                            @disbursement.DepartmentName
                        </td>
                        <td>
                            @disbursement.Total
                        </td>
                        <td>
                            @disbursement.LastApprovedOnDate
                        </td>
                    </tr>
                }
            </tbody>
        </table>

    </div>
    <div class="col-md-12 mt-2" id="Scholarship">
        <h3 class="text-center">Scholarship</h3>
        <table class="table table-hover table-striped ApproverDisbursementTable">
            <thead>
                <tr>
                    <th style="display: none">giftDisbursementId</th>
                    <th>
                        Preparer
                    </th>
                    <th>
                        Form #
                    </th>                    
                    <th>
                        Department
                    </th>
                    <th>
                        Amount
                    </th>
                    <th>
                        Date Approved
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var disbursement in Model.ScholarshipDisbursements.GiftDisbursements)
                {
                    <tr>
                        <td style="display: none">@disbursement.Id</td>
                        <td>@disbursement.PreparedByFirstName @disbursement.PreparedByLastName</td>
                        <td>
                            @disbursement.FormNumber
                        </td>                       
                        <td>
                            @disbursement.DepartmentName
                        </td>
                        <td>
                            @disbursement.Total
                        </td>
                        <td>
                            @disbursement.LastApprovedOnDate
                        </td>
                    </tr>
                }
            </tbody>
        </table>

    </div>
    <div class="col-md-12 mt-2" id="APManager">
        <h3 class="text-center">AP Manager</h3>
        <table class="table table-hover table-striped ApproverDisbursementTable">
            <thead>
                <tr>
                    <th style="display: none">giftDisbursementId</th>
                    <th>
                        Preparer
                    </th>
                    <th>
                        Form #
                    </th>
                    <th>
                        Payment Type
                    </th>
                    <th>
                        Department
                    </th>
                    <th>
                        Amount
                    </th>
                    <th>
                        Date Approved
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var disbursement in Model.ApManagerDisbursements.GiftDisbursements)
                {
                    <tr>
                        <td style="display: none">@disbursement.Id</td>
                        <td>@disbursement.PreparedByFirstName @disbursement.PreparedByLastName</td>
                        <td>
                            @disbursement.FormNumber
                        </td>
                        <td>
                            @disbursement.PayeePaymentType
                        </td>
                        <td>
                            @disbursement.DepartmentName
                        </td>
                        <td>
                            @disbursement.Total
                        </td>
                        <td>
                            @disbursement.LastApprovedOnDate
                        </td>
                    </tr>
                }
            </tbody>
        </table>

    </div>

</div><!-- /.content-container -->
@section scripts {
    <script>
        $(document).ready(function () {
            // Color Variables
            const colors = {
                primaryBlue: '#0C234B',
                primarySkyBlue: '#81D3EB',
                primaryOasisBlue: '#378DBD',
                primaryAzuriteBlue: '#1E5288',
                primaryMidnightBlue: '#001C48',

                primaryRed: '#AB0520',
                primaryRedBloom: '#EF4056',
                primaryRedChili: '#8B0015',

                neutralCoolGray: '#E2E9EB',
                neutralWarmGray: '#F4EDE5',

                secondaryLeaf: '#70B865',
                secondaryRiver: '#007D84',
                secondarySilver: '#9EABAE',
                secondaryMesa: '#a95c42',

                legacyDarkSilver: '#49595E',
            };

        });
    </script>
    <script>
        $('#DisbursementSearchButton').click(function (e) {
            var formNumber = $('#DisbursementSearchInput').val();

            if (formNumber != undefined && formNumber.length > 0) {
                SearchByFormNumber(formNumber);
            }
        });

        function SearchByFormNumber(formNumber) {
            $('#DisbursementSearchMessage').text(null);

            $.ajax({
                type: "GET",
                url: '@Url.Action("GetGiftDisbursementByFormNumber")',
                data: { formNumber : formNumber },
                headers:
                {
                    "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                },
                success: function (data) {
                    if (data.id > 0) {
                        var url = `@Url.Action("Review", "GiftDisbursements")?giftDisbursementId=${data.id}`;
                        window.location.href = url;
                    }
                    else {
                        $('#DisbursementSearchMessage').text('No Results')
                    }
                },
                error: function (request, error) {
                    $('#DisbursementSearchMessage').text('An error has occurred while processing your request');
                }
            });
        }

        var pageStart = 1;

        // Data Table Variables
        // ------------------------------------------------------------
        var paginationControlVisibility = "p";
        var lengthControlVisibility = "l";

        $("#CountsTable")
            //.on('preXhr.dt', function (e, settings, data) {
            //    data.searchValue = data.search.value,
            //        data.sortColumn = data.columns[data.order[0].column].data,
            //        data.sortColumnDirection = data.order[0].dir
            //})
            .DataTable({
                pageLength: 10,
                "lengthMenu": [10, 25, 50, 75, 100],
                // dom() more info: https://datatables.net/reference/option/dom ::
                // B = Buttons
                // l = page (l)ength changing input control
                // f = (f)iltering input
                // r = p(r)ocessing display element
                // t = (t)able
                // i = table (i)nfo summary - aka: showing x of x records
                // p = (p)agination control
                dom: 'B' + lengthControlVisibility + 'frti' + paginationControlVisibility,
                cache: true,
                paging: true,
                //processing: true,
                //serverSide: true,

                language: {
                    //processing: '<div id="dt-processing">Processing... <div class="spinner"></div></div>',
                    //processing: '<i class="fa fa-spin fa-asterisk fa-fw"></i> <span class=""> Loading...</span>',
                    search: 'Filter',
                    emptyTable: "No records found."
                },
                // Ellipsis: https://datatables.net/plug-ins/dataRender/ellipsis more info: https://cdn.datatables.net/plug-ins/1.10.19/dataRender/ellipsis.js ::
                columnDefs: [

                    {
                        targets: 0,
                        data: 'AssociateVicePresidentDisbursements',
                        searchable: true,
                        shrinkToFit: true,
                        nowrap: true
                    },
                    {
                        targets: 1,
                        data: 'VicePresidentDisbursements',
                        searchable: true,
                        shrinkToFit: true,
                        nowrap: true
                    },
                    {
                        targets: 2,
                        data: 'CFODisbursements',
                        searchable: true,
                        shrinkToFit: true,
                        nowrap: true
                    },
                    {
                        targets: 3,
                        data: 'GeneralCounselDisbursements',
                        searchable: true,
                        shrinkToFit: true,
                        nowrap: true
                    },
                    {
                        targets: 4,
                        data: 'ApReviewerDisbursements',
                        searchable: true,
                        shrinkToFit: true,
                        nowrap: true
                    },
                    {
                        targets: 5,
                        data: 'ScholarshipDisbursements',
                        searchable: true,
                        shrinkToFit: true,
                        nowrap: true
                    },
                    {
                        targets: 6,
                        data: 'ApManagerDisbursements',
                        searchable: true,
                        shrinkToFit: true,
                        nowrap: true
                    }

                ],
                buttons: [
                    'excel', 'pdfHtml5', 'print'
                ],
            });

        $(".ApproverDisbursementTable")
            //.on('preXhr.dt', function (e, settings, data) {
            //    data.searchValue = data.search.value,
            //        data.sortColumn = data.columns[data.order[0].column].data,
            //        data.sortColumnDirection = data.order[0].dir
            //})
            .DataTable({
                pageLength: 20,
                "lengthMenu": [20, 40, 60, 80, 100],
                // dom() more info: https://datatables.net/reference/option/dom ::
                // B = Buttons
                // l = page (l)ength changing input control
                // f = (f)iltering input
                // r = p(r)ocessing display element
                // t = (t)able
                // i = table (i)nfo summary - aka: showing x of x records
                // p = (p)agination control
                dom: 'B' + lengthControlVisibility + 'frti' + paginationControlVisibility,
                cache: true,
                paging: true,
                //processing: true,
                //serverSide: true,

                language: {
                    //processing: '<div id="dt-processing">Processing... <div class="spinner"></div></div>',
                    //processing: '<i class="fa fa-spin fa-asterisk fa-fw"></i> <span class=""> Loading...</span>',
                    search: 'Filter',
                    emptyTable: "No records found."
                },
                // Ellipsis: https://datatables.net/plug-ins/dataRender/ellipsis more info: https://cdn.datatables.net/plug-ins/1.10.19/dataRender/ellipsis.js ::
                columnDefs: [
                    {
                        targets: 0,
                        className: 'hide',
                        data: 'giftDisbursementId'
                    },
                    {
                        targets: 1,
                        data: 'preparedBy',
                        searchable: true,
                        nowrap: true,
                        shrinkToFit: true,
                    },
                    {
                        targets: 2,
                        data: 'formNumber',
                        searchable: true,
                        shrinkToFit: true,
                        nowrap: true
                    },
                    {
                        targets: 3,
                        data: 'departmentName',
                        searchable: true,
                        shrinkToFit: true,
                        nowrap: true
                    },
                    {
                        targets: 4,
                        data: 'total',
                        searchable: true,
                        render: $.fn.dataTable.render.number(',', '.', 3, '$')
                    },

                    {
                        type: 'date',
                        targets: 5,
                        data: 'lastApprovedOnDate',
                        searchable: true,
                        shrinkToFit: true
                    }

                ],
                "order": [
                    [5, "desc"]
                ],
                buttons: [
                    'excel', 'pdfHtml5', 'print'
                ],
            });

        $(".ApproverDisbursementTable tbody").on("click", "tr", function () { clickTable(this); });

        function clickTable(elem) {
            var tableData = $(elem).children('td').map(function () {
                return $(this).text();
            }).get();

            var id = tableData[0];
            var goToUrl = `@Url.Action("Review", "GiftDisbursements")?giftDisbursementId=${id}`;
            window.location.href = goToUrl;
        }
    </script>
}
